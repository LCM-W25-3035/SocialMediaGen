<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>News Analytics and Social Media Assistant</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'styles.css' %}">
    <style>
        /* Basic Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Body */
        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            background-color: #f4f4f4;
            color: #333;
        }

        /* Header */
        header {
            background: #333;
            color: #fff;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        header .logo h1 {
            font-size: 24px;
        }

        header nav ul {
            list-style: none;
            display: flex;
        }

        header nav ul li {
            margin: 0 15px;
        }

        header nav ul li a {
            color: #fff;
            text-decoration: none;
            font-size: 18px;
        }

        header nav ul li a:hover {
            color: #ff6f61;
        }

        /* Main Content */
        main {
            padding: 40px;
        }

        /* Section Styles */
        .section {
            margin-bottom: 40px;
        }

        h2,
        h3,
        h4 {
            color: #333;
        }

        /* Trending and News Categories */
        .news-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .news-item {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            width: 45%;
            cursor: pointer;
            transition: transform 0.2s, background-color 0.2s;
        }

        .news-item:hover {
            background-color: #f0f0f0;
            transform: translateY(-5px);
        }

        .news-item h3 {
            font-size: 20px;
            margin-bottom: 10px;
        }

        .news-item p {
            font-size: 16px;
            color: #555;
        }

        .news-item a {
            color: #ff6f61;
            text-decoration: none;
        }

        /* Load More Button */
        #load-more-btn {
            display: block;
            margin: 20px auto;
            padding: 10px 20px;
            background-color: #ff6f61;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        #load-more-btn:hover {
            background-color: #e55b4b;
        }

        /* Social Media Post Generator */
        #social {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        textarea {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-size: 16px;
            margin-bottom: 20px;
            height: 150px;
        }

        button {
            padding: 10px 20px;
            background-color: #ff6f61;
            border: none;
            color: #fff;
            font-size: 18px;
            cursor: pointer;
            border-radius: 5px;
        }

        button:hover {
            background-color: #e55b4b;
        }

        .generated-post {
            margin-top: 20px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        /* Footer */
        footer {
            background-color: #333;
            color: #fff;
            text-align: center;
            padding: 20px;
        }

        /* Dropdown Styling */
        .topic-dropdown {
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
        }

        select {
            padding: 10px;
            font-size: 16px;
            border-radius: 5px;
            border: 1px solid #ddd;
            width: 200px;
        }
    </style>
</head>

<body>
    <!-- Header with Navbar -->
    <header>
        <div class="logo">
            <h1>News Analytics</h1>
        </div>
        <nav>
            <ul>
                <!-- You can add more links here if needed -->
            </ul>
        </nav>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Dropdown for Topic Filter -->
        <div class="topic-dropdown">
            <label for="topic-filter">Filter by Topic:</label>
            <select id="topic-filter" class="form-control">
                <option value="">All Topics</option>
                <option value="Education">Education</option>
                <option value="Entertainment">Entertainment</option>
                <option value="Environment">Environment</option>
                <option value="Finance">Finance</option>
                <option value="Food">Food</option>
                <option value="Health">Health</option>
                <option value="Politics">Politics</option>
                <option value="Sports">Sports</option>
                <option value="Technology">Technology</option>
                <option value="Travel">Travel</option>
            </select>
        </div>

        <!-- Trending News Section -->
        <section id="trending" class="section">
            <h2>Trending News</h2>
            <div class="news-container" id="news-container">
                <!-- News items will be dynamically inserted here -->
            </div>
            <!-- Load More Button -->
            <button id="load-more-btn" style="display: none;">Load More</button>
        </section>

        <!-- Social Media Post Generator -->
        <section id="social" class="section">
            <h2>Generate Social Media Post</h2>
            <textarea id="newsInput" placeholder="The news summary will appear here..."></textarea>
            <button id="generatePostBtn">Generate Post</button>
            <div id="generatedPost" class="generated-post"></div>
        </section>
    </main>

    <!-- Footer -->
    <footer>
        <p>&copy; 2025 News Analytics. All rights reserved.</p>
    </footer>

    <script>
        let currentPage = 1; // Track the current page
        const topicFilter = document.getElementById('topic-filter');

        // Fetch news from Django backend
        async function fetchNews(page, topic = '') {
            try {
                const response = await fetch(`/fetch-news/?page=${page}&topic=${topic}`);  // Pass the page and topic
                const newsData = await response.json();

                const newsContainer = document.getElementById('news-container');
                const loadMoreButton = document.getElementById('load-more-btn');

                // Clear existing content if it's the first page
                if (page === 1) {
                    newsContainer.innerHTML = '';
                }

                // Loop through news data and create news items
                newsData.forEach(news => {
                    const newsItem = document.createElement('div');
                    newsItem.className = 'news-item';
                    newsItem.innerHTML = `
                        <div class="news-block" onclick="window.location.href='/news/${news._id}/'">
                            <h3>${news.headline}</h3>
                            <p>${news.summary}</p>
                            <p><strong>Source:</strong> ${news.source}</p>
                        </div>
                    `;
                    newsContainer.appendChild(newsItem);
                });

                // Show the "Load More" button if there are more items
                if (newsData.length > 0) {
                    loadMoreButton.style.display = 'block';
                } else {
                    loadMoreButton.style.display = 'none';
                }
            } catch (error) {
                console.error('Error fetching news:', error);
            }
        }

        // Load more news when the "Load More" button is clicked
        document.getElementById('load-more-btn').addEventListener('click', () => {
            currentPage += 1; // Increment the page number
            fetchNews(currentPage, topicFilter.value); // Fetch the next page of news with the selected topic
        });

        // Fetch the first page of news when the page loads
        document.addEventListener('DOMContentLoaded', () => fetchNews(currentPage));

        // Fetch news whenever the topic filter changes
        topicFilter.addEventListener('change', () => {
            currentPage = 1; // Reset to the first page
            fetchNews(currentPage, topicFilter.value); // Fetch news with the selected topic
        });
    </script>
</body>

</html>
